<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Admin - Ruposri</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-50">
    <header class="bg-indigo-600 text-white p-4">
        <div class="container mx-auto flex justify-between items-center">
            <h1 class="text-2xl font-bold">Ruposri Admin</h1>
            <button id="logout-btn" class="bg-red-500 px-4 py-2 rounded">Logout</button>
        </div>
    </header>

    <main class="container mx-auto p-4">
        <h2 class="text-xl font-semibold mb-6">Order Management</h2>
        
        <div class="bg-white rounded-lg shadow overflow-hidden">
            <table class="min-w-full">
                <thead class="bg-gray-100">
                    <tr>
                        <th class="px-6 py-3 text-left">Order ID</th>
                        <th class="px-6 py-3 text-left">Product</th>
                        <th class="px-6 py-3 text-left">Customer</th>
                        <th class="px-6 py-3 text-left">Status</th>
                        <th class="px-6 py-3 text-left">Actions</th>
                    </tr>
                </thead>
                <tbody id="orders-table" class="divide-y divide-gray-200">
                    <!-- Orders will be loaded here -->
                </tbody>
            </table>
        </div>
    </main>

    <script src="/js/firebase.js"></script>
    <script src="/js/auth.js"></script>
    <script src="/js/orders.js"></script>
    <script>
        // Load orders
        function loadOrders() {
            db.collection('orders').orderBy('createdAt', 'desc').onSnapshot(snapshot => {
                const table = document.getElementById('orders-table');
                table.innerHTML = '';
                
                snapshot.forEach(doc => {
                    const order = doc.data();
                    
                    // Get user email
                    db.collection('users').doc(order.userId).get().then(userDoc => {
                        const userEmail = userDoc.data().email;
                        
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td class="px-6 py-4">${doc.id.substring(0, 8)}...</td>
                            <td class="px-6 py-4">${order.product} (x${order.quantity})</td>
                            <td class="px-6 py-4">${userEmail}</td>
                            <td class="px-6 py-4">
                                <span class="px-2 py-1 rounded-full text-xs 
                                    ${order.status === 'pending' ? 'bg-yellow-100 text-yellow-800' : 
                                      order.status === 'confirmed' ? 'bg-green-100 text-green-800' : 
                                      'bg-gray-100 text-gray-800'}">
                                    ${order.status}
                                </span>
                            </td>
                            <td class="px-6 py-4">
                                <select onchange="updateStatus('${doc.id}', this.value)" 
                                        class="border rounded p-1">
                                    <option value="pending" ${order.status === 'pending' ? 'selected' : ''}>Pending</option>
                                    <option value="confirmed" ${order.status === 'confirmed' ? 'selected' : ''}>Confirmed</option>
                                    <option value="shipped" ${order.status === 'shipped' ? 'selected' : ''}>Shipped</option>
                                </select>
                            </td>
                        `;
                        table.appendChild(row);
                    });
                });
            });
        }
        
        // Initial load
        firebase.auth().onAuthStateChanged(user => {
            if (user) {
                loadOrders();
            } else {
                window.location.href = '/index.html';
            }
        });
        
        // Logout
        document.getElementById('logout-btn').addEventListener('click', () => {
            firebase.auth().signOut();
        });

        // Live order listener (add to admin.js)
function setupRealTimeOrders() {
  firebase.firestore().collection("orders")
    .onSnapshot((snapshot) => {
      snapshot.docChanges().forEach((change) => {
        if (change.type === "modified") {
          console.log("Order updated:", change.doc.data());
          // Update your UI here
        }
      });
    });
}

// Call this when admin page loads
setupRealTimeOrders();
    </script>
</body>
</html>