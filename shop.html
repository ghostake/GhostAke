<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Shop - Ruposri</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-50">
    <header class="bg-indigo-600 text-white p-4">
        <div class="container mx-auto flex justify-between items-center">
            <h1 class="text-2xl font-bold">Ruposri Shop</h1>
            <button id="logout-btn" class="bg-red-500 px-4 py-2 rounded">Logout</button>
        </div>
    </header>

    <main class="container mx-auto p-4">
        <h2 class="text-xl font-semibold mb-6">Available Products</h2>
        
        <!-- Manual product listing (no database) -->
        <div class="grid md:grid-cols-3 gap-6">
            <div class="bg-white p-6 rounded-lg shadow">
                <h3 class="font-bold text-lg mb-2">Premium T-Shirt</h3>
                <p class="text-gray-600 mb-4">High quality cotton t-shirt</p>
                <p class="text-indigo-600 font-bold mb-4">$24.99</p>
                <button onclick="showOrderForm('Premium T-Shirt')" 
                        class="bg-indigo-600 text-white px-4 py-2 rounded w-full">
                    Order Now
                </button>
            </div>
            
            <!-- Add more products as needed -->
        </div>

        <!-- Order Form (hidden by default) -->
        <div id="order-form" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center">
            <div class="bg-white p-6 rounded-lg max-w-md w-full">
                <h3 class="font-bold text-lg mb-4">Place Your Order</h3>
                <div class="mb-4">
                    <label class="block text-gray-700 mb-2">Product</label>
                    <input id="order-product" type="text" readonly 
                           class="w-full p-2 border rounded">
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 mb-2">Quantity</label>
                    <input id="order-quantity" type="number" min="1" value="1"
                           class="w-full p-2 border rounded">
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 mb-2">Shipping Address</label>
                    <textarea id="order-address" 
                              class="w-full p-2 border rounded" rows="3"></textarea>
                </div>
                <div class="flex justify-end gap-2">
                    <button onclick="hideOrderForm()" 
                            class="bg-gray-500 text-white px-4 py-2 rounded">
                        Cancel
                    </button>
                    <!-- Change from this -->
<button onclick="confirmOrder()">Confirm</button>

<!-- To this (passing the order ID) -->
<button onclick="confirmOrder('${doc.id}')">Confirm</button>
                    </button>
                </div>
            </div>
        </div>
    </main>

    <script src="/js/firebase.js"></script>
    <script src="/js/auth.js"></script>
    <script src="/js/orders.js"></script>
    <script>
        // Order handling
        let currentProduct = '';
        
        function showOrderForm(productName) {
            currentProduct = productName;
            document.getElementById('order-product').value = productName;
            document.getElementById('order-form').classList.remove('hidden');
            document.getElementById('order-form').classList.add('flex');
        }
        
        function hideOrderForm() {
            document.getElementById('order-form').classList.add('hidden');
            document.getElementById('order-form').classList.remove('flex');
        }
        
    
function placeOrder() {
  const user = firebase.auth().currentUser;
  
  // This is where the structure is created
  const orderData = {
    userId: user.uid,                // Links order to user
    product: "Premium T-Shirt",      // Hardcoded or from UI
    status: "pending",               // Initial state
    createdAt: firebase.firestore.FieldValue.serverTimestamp() // Auto timestamp
  };

  firebase.firestore().collection('orders').add(orderData)
    .then(() => alert('Order placed!'))
    .catch(error => console.error("Error:", error));
}
            
            submitOrder(user.uid, currentProduct, quantity, address)
                .then(() => {
                    alert('Order placed successfully! We will contact you soon.');
                    hideOrderForm();
                })
                .catch(error => {
                    alert('Error: ' + error.message);
                });

        
        // Logout
        document.getElementById('logout-btn').addEventListener('click', () => {
            firebase.auth().signOut().then(() => {
                window.location.href = '/index.html';
            });
        });

       

    </script>
</body>
</html>